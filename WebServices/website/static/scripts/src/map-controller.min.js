var DEFAULT_LAT=42.6;var DEFAULT_LNG=-8.933;var DEFAULT_ZOOM=12;var DEFAULT_GS_ELEVATION=15;var USER_ZOOM=6;var TIMESTAMP_FORMAT="HH:mm:ss.sss";function centerMap(d,c,a,b){d.setView(new L.LatLng(c,a),b)}function locateUser(a,b){$.get("http://ipinfo.io",function(c){var d=c.loc.split(",");a.info("[map-ctrl] User located at = "+d);centerMap(b,d[0],d[1],USER_ZOOM)},"jsonp").fail(function(){a.warn("[map-ctrl] Could not locate user");centerMap(b,DEFAULT_LAT,DEFAULT_LNG,DEFAULT_ZOOM)})}var app=angular.module("satellite.tracker.js",["leaflet-directive","ngResource","ui.bootstrap","remoteValidation"]);app.config(function(a){a.decorator("$log",function(b){var c=null;return{setScope:function(d){c=d},log:function(){b.log.apply(null,["[log] "+arguments[0]]);c.$broadcast("logEvent",arguments[0])},info:function(){b.info.apply(null,["[info] "+arguments[0]]);c.$broadcast("infoEvent",arguments[0])},error:function(){b.error.apply(null,["[error] "+arguments[0]]);c.$broadcast("errEvent",arguments[0])},warn:function(){b.info.apply(null,["[warn] "+arguments[0]]);c.$broadcast("warnEvent",arguments[0])}}})});app.factory("listGroundStations",function(a){return a("/configuration/groundstations",{})});app.run(function(a,b){b.setScope(a)});app.controller("NotificationAreaController",["$scope","$filter",function(a,b){a.eventLog=[];a.$on("infoEvent",function(d,c){a.eventLog.unshift({type:d.name,timestamp:b("date")(new Date(),TIMESTAMP_FORMAT),msg:c})})}]);app.controller("GSAreaController",["$scope","$log",function(a,b){}]);app.controller("SCAreaController",["$scope","$log",function(a,b){}]);app.controller("MapController",["$scope","$log","$resource","leafletData","listGroundStations",function(b,e,d,a,c){angular.extend(b,{center:{lat:DEFAULT_LAT,lng:DEFAULT_LNG,zoom:DEFAULT_ZOOM}});a.getMap().then(function(f){locateUser(e,f)});b.init=function(){b._simulator=new Simulator(e,c)}}]);app.controller("GSMenuController",["$scope","$log","$modal",function(a,c,b){c.info("[map-ctrl] Adding GS modal...");a.addGroundStation=function(){var d=b.open({templateUrl:"/static/scripts/src/templates/addGroundStation.html",controller:"AddGSModalCtrl",backdrop:"false"})}}]);app.controller("AddGSModalCtrl",["$scope","$log","$modalInstance","leafletData",function(b,d,c,a){b.identifier="";b.callsign="";b.elevation=DEFAULT_GS_ELEVATION;angular.extend(b,{center:{lat:DEFAULT_LAT,lng:DEFAULT_LNG,zoom:DEFAULT_ZOOM},markers:{gsMarker:{lat:DEFAULT_LAT,lng:DEFAULT_LNG,message:"Place your GS!",focus:true,draggable:true}}});a.getMap().then(function(e){d.info("[map-ctrl] Defining modal map...");locateUser(d,e)});b.ok=function(){d.info("[map-ctrl] New ground station...");c.close()};b.cancel=function(){d.info("[map-ctrl] Canceling...");c.close()}}]);